<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the Hathi Trust Bookworm Tool • hathiTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the Hathi Trust Bookworm Tool">
<meta property="og:description" content="hathiTools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hathiTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_workflow.html">An Example Workflow</a>
    </li>
    <li>
      <a href="../articles/topic_models_using_hathi_ef.html">Topic Modeling using the Hathi Trust Extracted Features Files</a>
    </li>
    <li>
      <a href="../articles/using_the_hathi_bookworm.html">Using the Hathi Trust Bookworm Tool</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/xmarquez/hathiTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="using_the_hathi_bookworm_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the Hathi Trust Bookworm Tool</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/xmarquez/hathiTools/blob/HEAD/vignettes/articles/using_the_hathi_bookworm.Rmd" class="external-link"><code>vignettes/articles/using_the_hathi_bookworm.Rmd</code></a></small>
      <div class="hidden name"><code>using_the_hathi_bookworm.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="using-the-hathi-trust-bookworm-tool">Using the Hathi Trust Bookworm Tool<a class="anchor" aria-label="anchor" href="#using-the-hathi-trust-bookworm-tool"></a>
</h2>
<p>The Hathi Trust Bookworm (<a href="https://bookworm.htrc.illinois.edu/develop/" class="external-link uri">https://bookworm.htrc.illinois.edu/develop/</a>) is a tool similar to the <a href="https://books.google.com/ngrams" class="external-link">Google Books Ngram viewer</a> that allows one to retrieve word frequency data from the texts in the <a href="https://www.hathitrust.org/" class="external-link">Hathi Trust Digital Library</a>. With about 17 million digitised volumes in its database (many of them originally digitised for the Google Books project), the Hathi Trust Bookworm is a very powerful tool to explore trends in word frequencies over time. Moreover, in contrast to the Google Ngram viewer, the Bookworm can search over the metadata of the collection, making possible more informative queries about the sources of particular word frequency trends.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>This package offers one function, <code><a href="../reference/query_bookworm.html">query_bookworm()</a></code>, that makes it relatively easy to retrieve word frequency and other data from the Hathi Trust Bookworm into R, and to use it for exploratory analyses of word frequency trends.</p>
<p>For example, suppose we are interested in the changing frequencies of terms like “democracy”, “dictatorship”, “monarchy”, and so on. We can download the frequency of these terms (according to various metrics) with a single call:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xmarquez/hathiTools" class="external-link">hathiTools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/slider" class="external-link">slider</a></span><span class="op">)</span> <span class="co"># For moving averages</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"democracy"</span>, <span class="st">"dictatorship"</span>, <span class="st">"monarchy"</span>,</span>
<span>                        <span class="st">"aristocracy"</span>, <span class="st">"oligarchy"</span>, <span class="st">"tyranny"</span>,</span>
<span>                        <span class="st">"autocracy"</span><span class="op">)</span>,</span>
<span>                      counttype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WordsPerMillion"</span><span class="op">)</span>,</span>
<span>                      lims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1700</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This results in a nice, tidy tibble:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span></span>
<span><span class="co">#&gt; # A tibble: 2,247 × 4</span></span>
<span><span class="co">#&gt;    word      date_year  value counttype      </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;          </span></span>
<span><span class="co">#&gt;  1 democracy      1700 2.70   WordsPerMillion</span></span>
<span><span class="co">#&gt;  2 democracy      1701 0.123  WordsPerMillion</span></span>
<span><span class="co">#&gt;  3 democracy      1702 1.34   WordsPerMillion</span></span>
<span><span class="co">#&gt;  4 democracy      1703 0.765  WordsPerMillion</span></span>
<span><span class="co">#&gt;  5 democracy      1704 0.428  WordsPerMillion</span></span>
<span><span class="co">#&gt;  6 democracy      1705 0.0989 WordsPerMillion</span></span>
<span><span class="co">#&gt;  7 democracy      1706 0.163  WordsPerMillion</span></span>
<span><span class="co">#&gt;  8 democracy      1707 0.446  WordsPerMillion</span></span>
<span><span class="co">#&gt;  9 democracy      1708 0.0652 WordsPerMillion</span></span>
<span><span class="co">#&gt; 10 democracy      1709 0.0681 WordsPerMillion</span></span>
<span><span class="co">#&gt; # … with 2,237 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Which can be used for plotting:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>counttype <span class="op">=</span> <span class="st">"Words per million"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>rolling_avg <span class="op">=</span> <span class="fu">slide_dbl</span><span class="op">(</span><span class="va">value</span>, <span class="va">mean</span>, .before <span class="op">=</span> <span class="fl">10</span>, .after <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_year</span>, color <span class="op">=</span> <span class="va">word</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_year</span>, y <span class="op">=</span> <span class="va">rolling_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">counttype</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Approx. year of publication"</span>, y <span class="op">=</span> <span class="st">""</span>, subtitle <span class="op">=</span> <span class="st">"10 year rolling average, books published between 1700-2020"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Frequency of 'democracy' and other political terms in the HathiTrust corpus"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="images/using-the-hathi-bookworm-unnamed-chunk-3-1.png" alt=""><p class="caption">Figure 1</p>
</div>
<p>The trends are clear: “democracy” becomes a much more salient term during the 19th and 20th centuries, with big peaks around the World Wars and the end of the Cold War, and an increasing level of usage in this corpus since the 1970s.</p>
<p>We can also look at the frequency of democracy <em>relative</em> to another word (e.g., dictatorship) across time by using <code>counttype = "WordsRatio"</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span>word <span class="op">=</span> <span class="st">"democracy"</span>, compare_to <span class="op">=</span> <span class="st">"dictatorship"</span>,</span>
<span>                          lims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1900</span>, <span class="fl">2000</span><span class="op">)</span>, counttype <span class="op">=</span> <span class="st">"WordsRatio"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Frequency of 'democracy' relative to 'dictatorship' in the Bookworm corpus"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Approx. date of publication"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Ratio"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="images/using-the-hathi-bookworm-unnamed-chunk-4-1.png" alt=""><p class="caption">Figure 2</p>
</div>
<p>‘Democracy’ is always used more frequently than ‘dictatorship’ in this corpus during the 20th century, but especially right around the First World War.</p>
<p>We can also explore the kinds of books where ‘democracy’ is mentioned in the 20th century. This query groups the volumes that mention ‘democracy’ by both the year of publication and the volume classification in the Hathi Trust metadata:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span>word <span class="op">=</span> <span class="st">"democracy"</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date_year"</span>, <span class="st">"lc_classes"</span><span class="op">)</span>,</span>
<span>                          lims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1900</span>,<span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_year</span>, y <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="fu">str_trunc</span><span class="op">(</span><span class="va">lc_classes</span>, <span class="fl">40</span><span class="op">)</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">word</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradient2</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"Year"</span>, title <span class="op">=</span> <span class="st">"Frequency of 'democracy' \nacross library classifications"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Words per million"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="images/using-the-hathi-bookworm-unnamed-chunk-5-1.png" alt=""><p class="caption">Figure 3</p>
</div>
<p>As we might expect, most volumes classified as “Political Science”, “History”, and “Social Sciences” mention democracy more often than medicine or agriculture, especially in the second half of the 20th century. But a surprising number of books classified as “Education” mention democracy quite a bit, especially right around the Second World War.</p>
<p>It is also possible to further limit the query to, e.g., books published in a particular language or written by a particular author. For example, this gives the number of texts that use the word “democracy” in 1900-2000, grouped by library classification and language.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span>word <span class="op">=</span> <span class="st">"democracy"</span>,</span>
<span>                       lims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1900</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>                       groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lc_classes"</span>, <span class="st">"languages"</span><span class="op">)</span>,</span>
<span>                       counttype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TextCount"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">languages</span> <span class="op">==</span> <span class="st">"eng"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 22 × 7</span></span>
<span><span class="co">#&gt;    word      lc_classes                   langu…¹  value count…² min_y…³ max_y…⁴</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;                        &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 democracy unknown                      eng     697511 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  2 democracy Social Sciences              eng     186912 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  3 democracy General and Old World Histo… eng     133276 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  4 democracy Language and Literature      eng     117172 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  5 democracy Political Science            eng      91759 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  6 democracy Education                    eng      65825 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  7 democracy Philosophy, Psychology, and… eng      61692 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  8 democracy Law                          eng      56733 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt;  9 democracy Bibliography, Library Scien… eng      55101 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt; 10 democracy History of America           eng      48800 TextCo…    1900    2000</span></span>
<span><span class="co">#&gt; # … with 12 more rows, and abbreviated variable names ¹​languages, ²​counttype,</span></span>
<span><span class="co">#&gt; #   ³​min_year, ⁴​max_year</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Among texts which have some classification (most don’t!), ~90,000 political science texts mention the term.</p>
<p>And this query finds how many volumes between 1900 and 2000 had Alexis de Tocqueville as a first author published in English:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span>lims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1900</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>                       groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date_year"</span><span class="op">)</span>,</span>
<span>                       counttype <span class="op">=</span> <span class="st">"TotalTexts"</span>,</span>
<span>                       mainauthor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tocqueville, Alexis de, 1805-1859."</span>,</span>
<span>                                             <span class="st">"Tocqueville, Alexis de, 1805-1859"</span><span class="op">)</span>,</span>
<span>                       languages <span class="op">=</span> <span class="st">"eng"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res3</span></span>
<span><span class="co">#&gt; # A tibble: 23 × 3</span></span>
<span><span class="co">#&gt;    date_year value counttype </span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt; &lt;chr&gt;     </span></span>
<span><span class="co">#&gt;  1      1900     9 TotalTexts</span></span>
<span><span class="co">#&gt;  2      1904     2 TotalTexts</span></span>
<span><span class="co">#&gt;  3      1909     1 TotalTexts</span></span>
<span><span class="co">#&gt;  4      1948     4 TotalTexts</span></span>
<span><span class="co">#&gt;  5      1949     1 TotalTexts</span></span>
<span><span class="co">#&gt;  6      1952     2 TotalTexts</span></span>
<span><span class="co">#&gt;  7      1954     7 TotalTexts</span></span>
<span><span class="co">#&gt;  8      1958     1 TotalTexts</span></span>
<span><span class="co">#&gt;  9      1959     4 TotalTexts</span></span>
<span><span class="co">#&gt; 10      1961     2 TotalTexts</span></span>
<span><span class="co">#&gt; # … with 13 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>One can use <code>method = "returnPossibleFields"</code> to return the fields available for limiting a query or grouping the results:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span>word <span class="op">=</span> <span class="st">""</span>, method <span class="op">=</span> <span class="st">"returnPossibleFields"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 17 × 6</span></span>
<span><span class="co">#&gt;    name                    type      description tablename         dbname anchor</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                   &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;  &lt;chr&gt; </span></span>
<span><span class="co">#&gt;  1 lc_classes              character ""          lc_classesLookup  lc_cl… bookid</span></span>
<span><span class="co">#&gt;  2 lc_subclass             character ""          lc_subclassLookup lc_su… bookid</span></span>
<span><span class="co">#&gt;  3 fiction_nonfiction      character ""          fiction_nonficti… ficti… bookid</span></span>
<span><span class="co">#&gt;  4 genres                  character ""          genresLookup      genres bookid</span></span>
<span><span class="co">#&gt;  5 languages               character ""          languagesLookup   langu… bookid</span></span>
<span><span class="co">#&gt;  6 htsource                character ""          htsourceLookup    htsou… bookid</span></span>
<span><span class="co">#&gt;  7 digitization_agent_code character ""          digitization_age… digit… bookid</span></span>
<span><span class="co">#&gt;  8 mainauthor              character ""          mainauthorLookup  maina… bookid</span></span>
<span><span class="co">#&gt;  9 publisher               character ""          publisherLookup   publi… bookid</span></span>
<span><span class="co">#&gt; 10 format                  character ""          formatLookup      format bookid</span></span>
<span><span class="co">#&gt; 11 is_gov_doc              character ""          is_gov_docLookup  is_go… bookid</span></span>
<span><span class="co">#&gt; 12 page_count_bin          character ""          page_count_binLo… page_… bookid</span></span>
<span><span class="co">#&gt; 13 word_count_bin          character ""          word_count_binLo… word_… bookid</span></span>
<span><span class="co">#&gt; 14 publication_country     character ""          publication_coun… publi… bookid</span></span>
<span><span class="co">#&gt; 15 publication_state       character ""          publication_stat… publi… bookid</span></span>
<span><span class="co">#&gt; 16 publication_place       character ""          publication_plac… publi… bookid</span></span>
<span><span class="co">#&gt; 17 date_year               integer   ""          fastcat           date_… bookid</span></span></code></pre></div>
<p>We can also get a sample of the book titles and links for a particular year. (It’s a limited sample; the database will only pull the top 100 books mentioning the term, weighted by the frequency of the term in the volume). For example, we can pull out the top 100 books in the category “Education” that mention the word “democracy” in 1941, the year where education books seem to be most likely to mention democracy:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">res4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span>word <span class="op">=</span> <span class="st">"democracy"</span>,</span>
<span>                       date_year <span class="op">=</span> <span class="st">"1941"</span>,</span>
<span>                       lc_classes <span class="op">=</span> <span class="st">"Education"</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"search_results"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res4</span></span>
<span><span class="co">#&gt; # A tibble: 100 × 3</span></span>
<span><span class="co">#&gt;    htid                      title                                         url  </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;chr&gt;                                         &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 nc01.ark:/13960/t2v41mn4r Teaching democracy in the North Carolina pub… http…</span></span>
<span><span class="co">#&gt;  2 mdp.39015062763720        The education of free men in American democr… http…</span></span>
<span><span class="co">#&gt;  3 uc1.$b67929               The education of free men in American democr… http…</span></span>
<span><span class="co">#&gt;  4 mdp.39015068297905        The education of free men in American democr… http…</span></span>
<span><span class="co">#&gt;  5 uc1.$b67873               Pennsylvania bill of rights week. Recommenda… http…</span></span>
<span><span class="co">#&gt;  6 mdp.39015035886111        Education in a world of fear,                 http…</span></span>
<span><span class="co">#&gt;  7 coo.31924013433044        Education in a world of fear,                 http…</span></span>
<span><span class="co">#&gt;  8 mdp.39015031665543        Education and the morale of a free people.    http…</span></span>
<span><span class="co">#&gt;  9 uiug.30112108068831       Proceedings of the convention.                http…</span></span>
<span><span class="co">#&gt; 10 uc1.$b67928               Education and the morale of a free people.    http…</span></span>
<span><span class="co">#&gt; # … with 90 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>If you need a bigger sample, use the function <code><a href="../reference/workset_builder.html">workset_builder()</a></code> to query the Hathi Trust’s <a href="https://solr2.htrc.illinois.edu/solr-ef/" class="external-link">Workset Builder 2.0</a>; this can help you download even hundreds of thousands of volume IDs that meet specified criteria. (See also the article on example workflows for more).</p>
<p>We can investigate further any of these volumes by downloading their associated “Extracted Features” file (that is, a file with token counts and part of speech information that the Hathi Trust makes available). Here we download the word frequencies for the second Hathi Trust id, The education of free men in American democracy., available at <a href="http://hdl.handle.net/2027/mdp.39015062763720" class="external-link uri">http://hdl.handle.net/2027/mdp.39015062763720</a>, as a nice tidy <code>tibble</code> suitable for analysis with a package like <a href="https://github.com/juliasilge/tidytext" class="external-link">tidytext</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">extracted_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hathi_counts.html">get_hathi_counts</a></span><span class="op">(</span><span class="va">res4</span><span class="op">$</span><span class="va">htid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, dir <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">extracted_features</span></span>
<span><span class="co">#&gt; # A tibble: 20,600 × 6</span></span>
<span><span class="co">#&gt;    htid               token       POS   count section  page</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;       &lt;chr&gt; &lt;int&gt; &lt;chr&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 mdp.39015062763720 COMMISSION  NNP       1 body        1</span></span>
<span><span class="co">#&gt;  2 mdp.39015062763720 in          IN        1 body        1</span></span>
<span><span class="co">#&gt;  3 mdp.39015062763720 Free        NNP       1 body        1</span></span>
<span><span class="co">#&gt;  4 mdp.39015062763720 Men         NNP       1 body        1</span></span>
<span><span class="co">#&gt;  5 mdp.39015062763720 Democracy   NNP       1 body        1</span></span>
<span><span class="co">#&gt;  6 mdp.39015062763720 School      NNP       1 body        1</span></span>
<span><span class="co">#&gt;  7 mdp.39015062763720 POLICIES    NNPS      1 body        1</span></span>
<span><span class="co">#&gt;  8 mdp.39015062763720 National    NNP       1 body        1</span></span>
<span><span class="co">#&gt;  9 mdp.39015062763720 The         DT        1 body        1</span></span>
<span><span class="co">#&gt; 10 mdp.39015062763720 Association NNP       2 body        1</span></span>
<span><span class="co">#&gt; # … with 20,590 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>And we can extract the full metadata for that particular volume, which tells us this title was created by the Educational Policies Commission, National Education Association of the United States and the American Association of School Administrators:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hathi_meta.html">get_hathi_meta</a></span><span class="op">(</span><span class="va">res4</span><span class="op">$</span><span class="va">htid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, dir <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meta</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 22</span></span>
<span><span class="co">#&gt;   htid         schem…¹ id    type  dateC…² title contr…³ pubDate publi…⁴ pubPl…⁵</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 mdp.3901506… https:… http… "[[\…  2.02e7 The … "[{\"i…    1941 "{\"id… "{\"id…</span></span>
<span><span class="co">#&gt; # … with 12 more variables: language &lt;chr&gt;, accessRights &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   accessProfile &lt;chr&gt;, sourceInstitution &lt;chr&gt;, mainEntityOfPage &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   lcc &lt;chr&gt;, lccn &lt;chr&gt;, oclc &lt;chr&gt;, category &lt;chr&gt;, genre &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   typeOfResource &lt;chr&gt;, lastRightsUpdateDate &lt;int&gt;, and abbreviated variable</span></span>
<span><span class="co">#&gt; #   names ¹​schemaVersion, ²​dateCreated, ³​contributor, ⁴​publisher, ⁵​pubPlace</span></span>
<span><span class="co">#&gt; # ℹ Use `colnames()` to see all variable names</span></span></code></pre></div>
<p>You can also browse interactively these titles on the Hathi Trust website:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/browse_htids.html">browse_htids</a></span><span class="op">(</span><span class="va">res4</span><span class="op">)</span></span></code></pre></div>
<p>If you want to download lots of volumes and have <a href="https://linux.die.net/man/1/rsync" class="external-link">rsync</a> installed in your system, the functions <code><a href="../reference/rsync_from_hathi.html">rsync_from_hathi()</a></code> and <code><a href="../reference/htid_to_rsync.html">htid_to_rsync()</a></code> can facilitate the process; see the article on “Creating and Using Hathi Trust Worksets” for more.</p>
<p>One can get info about the Bookworm corpus itself by using <code>counttype = "TotalWords"</code> or <code>counttype = "TotalTexts"</code> and omitting the ‘word’ key. This query, for example gives you the total number of texts per language in the corpus used to build the Bookworm.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_bookworm.html">query_bookworm</a></span><span class="op">(</span>counttype <span class="op">=</span> <span class="st">"TotalTexts"</span>,</span>
<span>                       groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date_year"</span>, <span class="st">"languages"</span><span class="op">)</span>,</span>
<span>                       lims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1500</span>,<span class="fl">2022</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">res5</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>language <span class="op">=</span> <span class="fu">fct_lump_n</span><span class="op">(</span><span class="va">languages</span>, <span class="fl">10</span>, w <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">date_year</span>, <span class="va">language</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">language</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">date_year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">date_year</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">language</span><span class="op">)</span>, <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">language</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>rolling_avg <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu">slide_dbl</span><span class="op">(</span><span class="va">value</span>, <span class="va">mean</span>, .before <span class="op">=</span> <span class="fl">10</span>, .after <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_year</span>, y <span class="op">=</span> <span class="va">rolling_avg</span>, color <span class="op">=</span> <span class="va">language</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">language</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_year</span>, y <span class="op">=</span> <span class="va">value</span>, label <span class="op">=</span> <span class="va">label</span>, color <span class="op">=</span> <span class="va">language</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Total texts per language in the HathiTrust bookworm"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Log scale. Less common languages grouped as 'other'. 10 year rolling average."</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="images/using-the-hathi-bookworm-unnamed-chunk-9-1.png" alt=""><p class="caption">Figure 4</p>
</div>
<p>For a full list (with some metadata) for <em>all</em> volumes in the Hathi Trust collection, use the functions <code><a href="../reference/download_hathifile.html">download_hathifile()</a></code> and <code><a href="../reference/load_raw_hathifile.html">load_raw_hathifile()</a></code>.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>The Google Ngram Viewer does have some advantages over the bookworm, primarily the ability to retrieve data about bigram, trigram, 4-gram, and 5-gram frequencies over time, and to conduct wildcard and part-of-speech searches. This is not currently possible with the Bookworm.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Xavier Marquez, Ben Schmidt.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
