<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Example Workflow • hathiTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An Example Workflow">
<meta property="og:description" content="hathiTools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hathiTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_workflow.html">An Example Workflow</a>
    </li>
    <li>
      <a href="../articles/topic_models_using_hathi_ef.html">Topic Modeling using the Hathi Trust Extracted Features Files</a>
    </li>
    <li>
      <a href="../articles/using_the_hathi_bookworm.html">Using the Hathi Trust Bookworm Tool</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/xmarquez/hathiTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An Example Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/xmarquez/hathiTools/blob/HEAD/vignettes/articles/example_workflow.Rmd" class="external-link"><code>vignettes/articles/example_workflow.Rmd</code></a></small>
      <div class="hidden name"><code>example_workflow.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="an-example-workflow">An Example Workflow<a class="anchor" aria-label="anchor" href="#an-example-workflow"></a>
</h2>
<p>A typical workflow using this package involves selecting a sample of Hathi Trust IDs to work with using the function <code><a href="../reference/workset_builder.html">workset_builder()</a></code>; downloading and caching their extracted features files; reading some selection of these files into memory, based on their metadata or some other characteristics; and using the in-memory data to create document-term or term-co-occurrence matrices that can be used for further analysis.</p>
<p>The main feature of this package is the extensive use of caching: sync once with Hathi Trust, cache all files to appropriate formats, and read them in bulk (including their metadata).</p>
<p>This vignette gives an example of this workflow using texts from Jane Austen.</p>
<div class="section level3">
<h3 id="selecting-a-sample">Selecting a sample<a class="anchor" aria-label="anchor" href="#selecting-a-sample"></a>
</h3>
<p>We first load the package and create a workset with all the texts that list “Jane Austen” as an author/contributor.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xmarquez/hathiTools" class="external-link">hathiTools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">workset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workset_builder.html">workset_builder</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jane Austen"</span><span class="op">)</span></span>
<span><span class="va">workset</span></span>
<span><span class="co">#&gt; # A tibble: 881 × 2</span></span>
<span><span class="co">#&gt;    htid                          n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 pst.000023140158           1535</span></span>
<span><span class="co">#&gt;  2 inu.30000011371634         1425</span></span>
<span><span class="co">#&gt;  3 uc2.ark:/13960/t7mp4ws0s   1364</span></span>
<span><span class="co">#&gt;  4 mdp.39015066040364         1361</span></span>
<span><span class="co">#&gt;  5 mdp.39015004788835         1360</span></span>
<span><span class="co">#&gt;  6 dul1.ark:/13960/t5q82jx98  1258</span></span>
<span><span class="co">#&gt;  7 pst.000051409333           1109</span></span>
<span><span class="co">#&gt;  8 pst.000031098625           1108</span></span>
<span><span class="co">#&gt;  9 dul1.ark:/13960/t8x93fx03  1052</span></span>
<span><span class="co">#&gt; 10 dul1.ark:/13960/t4th9rm8z  1023</span></span>
<span><span class="co">#&gt; # … with 871 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Let’s look at the metadata of the first 10:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_workset_meta.html">get_workset_meta</a></span><span class="op">(</span><span class="va">workset</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">htid</span>, <span class="va">title</span>, <span class="va">contributor</span>, <span class="va">pubDate</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 4</span></span>
<span><span class="co">#&gt;    htid                      title                               contr…¹ pubDate</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;chr&gt;                               &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 pst.000023140158          The complete novels /               "{\"na…    1994</span></span>
<span><span class="co">#&gt;  2 inu.30000011371634        Complete novels /                   "{\"na…    1928</span></span>
<span><span class="co">#&gt;  3 uc2.ark:/13960/t7mp4ws0s  The complete novels of Jane Austen. "{\"na…    1933</span></span>
<span><span class="co">#&gt;  4 mdp.39015066040364        The complete novels of Jane Austen. "{\"na…    1979</span></span>
<span><span class="co">#&gt;  5 mdp.39015004788835        The complete novels of Jane Austen. "{\"na…    1933</span></span>
<span><span class="co">#&gt;  6 dul1.ark:/13960/t5q82jx98 Northanger Abbey : and Persuasion / "[{\"n…    1818</span></span>
<span><span class="co">#&gt;  7 pst.000051409333          The Complete novels /               "{\"na…    1981</span></span>
<span><span class="co">#&gt;  8 pst.000031098625          The complete novels /               "{\"na…    1981</span></span>
<span><span class="co">#&gt;  9 dul1.ark:/13960/t8x93fx03 Emma : a novel : in three volumes / "{\"na…    1816</span></span>
<span><span class="co">#&gt; 10 dul1.ark:/13960/t4th9rm8z Mansfield Park : a novel : in thre… "{\"na…    1816</span></span>
<span><span class="co">#&gt; # … with abbreviated variable name ¹​contributor</span></span></code></pre></div>
<p>We can create six worksets for each of the main titles, and download their metadata:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">emma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workset_builder.html">workset_builder</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jane Austen"</span>, title <span class="op">=</span> <span class="st">"Emma"</span><span class="op">)</span></span>
<span><span class="va">mansfield_park</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workset_builder.html">workset_builder</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jane Austen"</span>, title <span class="op">=</span> <span class="st">"Mansfield Park"</span><span class="op">)</span></span>
<span><span class="va">northanger_abbey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workset_builder.html">workset_builder</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jane Austen"</span>, title <span class="op">=</span> <span class="st">"Northanger Abbey"</span><span class="op">)</span></span>
<span><span class="va">sense_and_sensibility</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workset_builder.html">workset_builder</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jane Austen"</span>, title <span class="op">=</span> <span class="st">"Sense and Sensibility"</span><span class="op">)</span></span>
<span><span class="va">pride_and_prejudice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workset_builder.html">workset_builder</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jane Austen"</span>, title <span class="op">=</span> <span class="st">"Pride and Prejudice"</span><span class="op">)</span></span>
<span><span class="va">persuasion</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workset_builder.html">workset_builder</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jane Austen"</span>, title <span class="op">=</span> <span class="st">"Persuasion"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">austen_novels</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Emma"</span> <span class="op">=</span> <span class="va">emma</span>, </span>
<span>                           <span class="st">"Mansfield Park"</span> <span class="op">=</span> <span class="va">mansfield_park</span>, </span>
<span>                           <span class="st">"Northanger Abbey"</span> <span class="op">=</span> <span class="va">northanger_abbey</span>,</span>
<span>                           <span class="st">"Sense and Sensibility"</span> <span class="op">=</span> <span class="va">sense_and_sensibility</span>,</span>
<span>                           <span class="st">"Pride and Prejudice"</span> <span class="op">=</span> <span class="va">pride_and_prejudice</span>,</span>
<span>                           <span class="st">"Persuasion"</span> <span class="op">=</span> <span class="va">persuasion</span><span class="op">)</span>, </span>
<span>                           .id <span class="op">=</span> <span class="st">"Novel"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_workset_meta.html">get_workset_meta</a></span><span class="op">(</span><span class="va">austen_novels</span><span class="op">)</span></span></code></pre></div>
<p>The workset metadata is by default cached in <code>"./metadata"</code>, so the function will not attempt to download it from Hathi a second time. Downloading metadata this way is quite slow, and likely to fail for more than about 1,000 volumes; a better way of gathering metadata for many volumes is to rsync the EF files (using <code><a href="../reference/rsync_from_hathi.html">rsync_from_hathi()</a></code>), and then use <code><a href="../reference/cache_htids.html">cache_htids()</a></code> to cache them (including the volume- and page-level metadata).</p>
<p>We can visualize this metadata:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">austen_novels</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">pubDate</span>, <span class="va">Novel</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pubDate</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">Novel</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1825</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Publication date"</span>, y <span class="op">=</span> <span class="st">"Number of copies in Hathi Trust"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/example-workflow-unnamed-chunk-5-1.png"></p>
<p>Note that actual titles are quite various, including adaptations of Austen’s work:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">austen_novels</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">Novel</span>, <span class="va">title</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="17%">
<col width="78%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">Novel</th>
<th align="left">title</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Emma</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Emma</td>
<td align="left">Emma /</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Emma / Jane Austen edited by Mary Lascelles ; new introduction by Peter Conrad.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Emma</td>
<td align="left">Emma : a novel /</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Emma : a novel : in three volumes /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Emma</td>
<td align="left">Emma : a novel.</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Emma : a novel. /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Emma</td>
<td align="left">Emma : Lady Susan /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Emma : With illus. of the author and her environment and pictures from early editions of the book /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Emma</td>
<td align="left">Emma,</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Emma.</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">Emma</td>
<td align="left">Emma: a novel.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Emma;</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Emma</td>
<td align="left">Emma; an authoritative text, backgrounds, reviews, and criticism.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Emma</td>
<td align="left">Sense and sensibility ; Emma ; and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield park /</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park /</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park : a novel /</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park : a novel : in three volumes /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park : a novel.</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield park,</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park,</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield park.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park.</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">Mansfield Park</td>
<td align="left">Mansfield Park: a novel.</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Mansfield Park</td>
<td align="left">Pride and prejudice ; Mansfield park ; and Northanger Abbey /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey &amp; Persuasion</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger abbey /</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey /</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey : <span class="math display">\[And Persuasion.\]</span>
</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey : a novel /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey : A novel /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey : a novel ; Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey : a novel.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey : and Persuasion /</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger abbey : and, Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey ; and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey ; and, Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey ; Lady Susan ; The Watsons ; and, Sanditon /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey ; Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger abbey <span class="math display">\[&amp;\]</span> Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey <span class="math display">\[with her “Persuasion”.\]</span>
</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey and persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger abbey and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger abbey, a novel and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey, and Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger abbey, Persuasion,</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey.</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger abbey. A novel.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Northanger Abbey; and, Persuasion;</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Pride &amp; prejudice : Northanger Abbey /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Northanger Abbey</td>
<td align="left">Pride and prejudice : and Northanger Abbey /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Northanger Abbey</td>
<td align="left">Pride and prejudice ; Mansfield park ; and Northanger Abbey /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey &amp; Persuasion</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey : <span class="math display">\[And Persuasion.\]</span>
</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey : a novel ; Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey : and Persuasion /</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger abbey : and, Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey ; and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey ; and, Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey ; Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger abbey <span class="math display">\[&amp;\]</span> Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey <span class="math display">\[with her “Persuasion”.\]</span>
</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey and persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger abbey and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger abbey, a novel and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey, and Persuasion /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Northanger abbey, Persuasion,</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Northanger Abbey; and, Persuasion;</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Persuasion /</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Persuasion and Lady Susan /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Persuasion,</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Persuasion.</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">Sense and sensibility ; and Persuasion …</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Sense and sensibility ; Emma ; and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Persuasion</td>
<td align="left">The manuscript chapters of Persuasion /</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Persuasion</td>
<td align="left">Two chapters of Persuasion printed from Jane Austen’s autograph.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice /</td>
<td align="right">35</td>
</tr>
<tr class="odd">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice : a novel /</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice : a novel : in two volumes /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice : a novel.</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice : and Northanger Abbey /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice ; Mansfield park ; and Northanger Abbey /</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice <span class="math display">\[and\]</span> Sense and sensibility.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice a novel /</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice,</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice.</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice. Sense and sensibility.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Pride and Prejudice</td>
<td align="left">Pride and prejudice: text, backgrounds, criticism.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Sense and Sensibility</td>
<td align="left">Pride and prejudice <span class="math display">\[and\]</span> Sense and sensibility.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Sense and Sensibility</td>
<td align="left">Pride and prejudice. Sense and sensibility.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility /</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility : /</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility : a novel /</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility ; and Persuasion …</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility ; Emma ; and Persuasion.</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility,</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility.</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility. by Ian Watt.</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility: a novel. v. 1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Sense and Sensibility</td>
<td align="left">Sense and sensibility;</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Let’s select a subset of these works to model more fully:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">austen_sample</span> <span class="op">&lt;-</span> <span class="va">austen_novels</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Novel</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="syncing-and-caching-extracted-features">Syncing and Caching Extracted Features<a class="anchor" aria-label="anchor" href="#syncing-and-caching-extracted-features"></a>
</h3>
<p>We now rsync the JSON files of the volumes in this sample from Hathi Trust and cache them locally in fast-loading formats.</p>
<p>This package has opinionated defaults: if you don’t do anything, it will assume you want to rsync and cache all your extracted features files to <code>getOption("hathiTools.ef.dir")</code>, which is just ./hathi-ef.You can, however, set your options differently, either by specifying <code>dir</code> explicitly in <code><a href="../reference/rsync_from_hathi.html">rsync_from_hathi()</a></code>, <code><a href="../reference/cache_htids.html">cache_htids()</a></code>, <code><a href="../reference/find_cached_htids.html">find_cached_htids()</a></code>, and <code><a href="../reference/read_cached_htids.html">read_cached_htids()</a></code>, or by setting the <code>hathiTools.ef.dir</code> option directly (i.e., calling <code>options(hathiTools.ef.dir = "your_preferred_dir")</code>).</p>
<p>We’ll use a temporary directory here:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>hathiTools.ef.dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rsync_from_hathi.html">rsync_from_hathi</a></span><span class="op">(</span><span class="va">austen_sample</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Then we cache them to <strong>csv</strong> and <strong>parquet</strong> formats simultaneously (just because we can: you can also just cache them to one of these formats):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cache_htids.html">cache_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"csv"</span>, <span class="st">"parquet"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 108 × 5</span></span>
<span><span class="co">#&gt;    htid                      local_loc                    cache…¹ cache…² exists</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;glue&gt;                       &lt;chr&gt;   &lt;chr&gt;   &lt;lgl&gt; </span></span>
<span><span class="co">#&gt;  1 pst.000066449096          C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  2 mdp.39015041924641        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  3 mdp.39015005734879        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  4 uiuo.ark:/13960/t4rj54s3j C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  5 hvd.32044050792100        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  6 hvd.hwiwg8                C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  7 mdp.39015091627573        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  8 uc1.31158008377706        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  9 hvd.32044004573549        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 10 mdp.39015007028700        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; # … with 98 more rows, and abbreviated variable names ¹​cache_format,</span></span>
<span><span class="co">#&gt; #   ²​cache_type</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>By default, <code><a href="../reference/cache_htids.html">cache_htids()</a></code> caches EF files and associated volume-level and page-level metadata, though you can also just cache metadata or EF files separately:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_cached_htids.html">find_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"csv"</span>, <span class="st">"parquet"</span>, <span class="st">"none"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">cache_type</span>, <span class="va">cache_format</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 3</span></span>
<span><span class="co">#&gt;   cache_type cache_format     n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 ef         csv.gz          18</span></span>
<span><span class="co">#&gt; 2 ef         parquet         18</span></span>
<span><span class="co">#&gt; 3 meta       csv.gz          18</span></span>
<span><span class="co">#&gt; 4 meta       parquet         18</span></span>
<span><span class="co">#&gt; 5 none       json.bz2        18</span></span>
<span><span class="co">#&gt; 6 pagemeta   csv.gz          18</span></span>
<span><span class="co">#&gt; 7 pagemeta   parquet         18</span></span></code></pre></div>
<p>The function <code><a href="../reference/find_cached_htids.html">find_cached_htids()</a></code> finds the physical location of files in the sample, in case you prefer to manipulate these directly:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_cached_htids.html">find_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_format <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 18 × 5</span></span>
<span><span class="co">#&gt;    htid                      local_loc                    cache…¹ cache…² exists</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;glue&gt;                       &lt;chr&gt;   &lt;chr&gt;   &lt;lgl&gt; </span></span>
<span><span class="co">#&gt;  1 pst.000066449096          C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  2 mdp.39015041924641        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  3 mdp.39015005734879        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  4 uiuo.ark:/13960/t4rj54s3j C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  5 hvd.32044050792100        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  6 hvd.hwiwg8                C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  7 mdp.39015091627573        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  8 uc1.31158008377706        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt;  9 hvd.32044004573549        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 10 mdp.39015007028700        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 11 mdp.39015009048458        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 12 uiuo.ark:/13960/t09w14g77 C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 13 pst.000025735086          C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 14 mdp.39015004997253        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 15 hvd.hn6m7q                C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 16 uiuo.ark:/13960/t3fx7zt1f C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 17 hvd.hwhs4m                C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; 18 nyp.33433074920525        C:\Users\marquexa\AppData\L… json.b… none    TRUE  </span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​cache_format, ²​cache_type</span></span>
<span><span class="fu"><a href="../reference/find_cached_htids.html">find_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_type <span class="op">=</span> <span class="st">"ef"</span>, cache_format <span class="op">=</span> <span class="st">"csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 18 × 5</span></span>
<span><span class="co">#&gt;    htid                      local_loc                    cache…¹ cache…² exists</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;glue&gt;                       &lt;chr&gt;   &lt;chr&gt;   &lt;lgl&gt; </span></span>
<span><span class="co">#&gt;  1 pst.000066449096          C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  2 mdp.39015041924641        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  3 mdp.39015005734879        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  4 uiuo.ark:/13960/t4rj54s3j C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  5 hvd.32044050792100        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  6 hvd.hwiwg8                C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  7 mdp.39015091627573        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  8 uc1.31158008377706        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt;  9 hvd.32044004573549        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 10 mdp.39015007028700        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 11 mdp.39015009048458        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 12 uiuo.ark:/13960/t09w14g77 C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 13 pst.000025735086          C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 14 mdp.39015004997253        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 15 hvd.hn6m7q                C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 16 uiuo.ark:/13960/t3fx7zt1f C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 17 hvd.hwhs4m                C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; 18 nyp.33433074920525        C:\Users\marquexa\AppData\L… csv.gz  ef      TRUE  </span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​cache_format, ²​cache_type</span></span>
<span><span class="fu"><a href="../reference/find_cached_htids.html">find_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_type <span class="op">=</span> <span class="st">"meta"</span>, cache_format <span class="op">=</span> <span class="st">"csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 18 × 5</span></span>
<span><span class="co">#&gt;    htid                      local_loc                    cache…¹ cache…² exists</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                     &lt;glue&gt;                       &lt;chr&gt;   &lt;chr&gt;   &lt;lgl&gt; </span></span>
<span><span class="co">#&gt;  1 pst.000066449096          C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  2 mdp.39015041924641        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  3 mdp.39015005734879        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  4 uiuo.ark:/13960/t4rj54s3j C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  5 hvd.32044050792100        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  6 hvd.hwiwg8                C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  7 mdp.39015091627573        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  8 uc1.31158008377706        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt;  9 hvd.32044004573549        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 10 mdp.39015007028700        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 11 mdp.39015009048458        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 12 uiuo.ark:/13960/t09w14g77 C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 13 pst.000025735086          C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 14 mdp.39015004997253        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 15 hvd.hn6m7q                C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 16 uiuo.ark:/13960/t3fx7zt1f C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 17 hvd.hwhs4m                C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; 18 nyp.33433074920525        C:\Users\marquexa\AppData\L… csv.gz  meta    TRUE  </span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​cache_format, ²​cache_type</span></span></code></pre></div>
<p>Once cached, we can read this whole corpus into memory very quickly, including all the volume-level and page-level metadata. Here we load from the default cache format, which is given by <code>getOption("hathiTools.cacheformat")</code> and is csv.gz unless explicitly changed:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">full_corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_cached_htids.html">read_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span><span class="op">)</span></span>
<span><span class="va">full_corpus</span></span>
<span><span class="co">#&gt; # A tibble: 1,361,736 × 44</span></span>
<span><span class="co">#&gt;    htid        token POS   count section  page schem…¹ id    type  dateC…² title</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 pst.000066… Clas… NNS       1 body        5 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  2 pst.000066… .     .         1 body        5 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  3 pst.000066… BORD… NNS       1 body        5 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  4 pst.000066… Plea… UH        1 body        8 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  5 pst.000066… writ… VBG       1 body        8 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  6 pst.000066… Brot… NNPS      1 body        8 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  7 pst.000066… rese… VBN       1 body        8 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  8 pst.000066… any   DT        3 body        8 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt;  9 pst.000066… LLC   NNP       1 body        8 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt; 10 pst.000066… this  DT        1 body        8 https:… http… "[[\…  2.02e7 Emma…</span></span>
<span><span class="co">#&gt; # … with 1,361,726 more rows, 33 more variables: alternateTitle &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   contributor &lt;chr&gt;, pubDate &lt;int&gt;, publisher &lt;chr&gt;, pubPlace &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   language &lt;chr&gt;, accessRights &lt;chr&gt;, accessProfile &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   sourceInstitution &lt;chr&gt;, mainEntityOfPage &lt;chr&gt;, oclc &lt;chr&gt;, isbn &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   genre &lt;chr&gt;, typeOfResource &lt;chr&gt;, lastRightsUpdateDate &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   enumerationChronology &lt;chr&gt;, lcc &lt;chr&gt;, lccn &lt;chr&gt;, category &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   seq &lt;chr&gt;, version &lt;chr&gt;, tokenCount &lt;int&gt;, lineCount &lt;int&gt;, …</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre></div>
<p>You can also load only particular bits of the data. For example, if you only want to load the extracted features files, volume-level metadata, and page-level metadata, you can do this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_cached_htids.html">read_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_type <span class="op">=</span> <span class="st">"ef"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,361,736 × 6</span></span>
<span><span class="co">#&gt;    htid             token    POS   count section  page</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 pst.000066449096 Classics NNS       1 body        5</span></span>
<span><span class="co">#&gt;  2 pst.000066449096 .        .         1 body        5</span></span>
<span><span class="co">#&gt;  3 pst.000066449096 BORDERS  NNS       1 body        5</span></span>
<span><span class="co">#&gt;  4 pst.000066449096 Please   UH        1 body        8</span></span>
<span><span class="co">#&gt;  5 pst.000066449096 writing  VBG       1 body        8</span></span>
<span><span class="co">#&gt;  6 pst.000066449096 Brothers NNPS      1 body        8</span></span>
<span><span class="co">#&gt;  7 pst.000066449096 reserved VBN       1 body        8</span></span>
<span><span class="co">#&gt;  8 pst.000066449096 any      DT        3 body        8</span></span>
<span><span class="co">#&gt;  9 pst.000066449096 LLC      NNP       1 body        8</span></span>
<span><span class="co">#&gt; 10 pst.000066449096 this     DT        1 body        8</span></span>
<span><span class="co">#&gt; # … with 1,361,726 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span>
<span></span>
<span><span class="fu"><a href="../reference/read_cached_htids.html">read_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_type <span class="op">=</span> <span class="st">"meta"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 18 × 25</span></span>
<span><span class="co">#&gt;    htid        schem…¹ id    type  dateC…² title alter…³ contr…⁴ pubDate publi…⁵</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;  </span></span>
<span><span class="co">#&gt;  1 pst.000066… https:… http… "[[\…  2.02e7 Emma… "[[\"L… "[{\"i…    2008 "{\"id…</span></span>
<span><span class="co">#&gt;  2 mdp.390150… https:… http… "[[\…  2.02e7 Emma…  &lt;NA&gt;   "{\"id…    1982 "{\"id…</span></span>
<span><span class="co">#&gt;  3 mdp.390150… https:… http… "[[\…  2.02e7 Emma…  &lt;NA&gt;   "[{\"i…    1898 "{\"id…</span></span>
<span><span class="co">#&gt;  4 uiuo.ark:/… https:… http… "[[\…  2.02e7 Mans…  &lt;NA&gt;   "{\"id…    1814 "{\"id…</span></span>
<span><span class="co">#&gt;  5 hvd.320440… https:… http… "[[\…  2.02e7 Mans…  &lt;NA&gt;   "{\"id…    1892 "{\"id…</span></span>
<span><span class="co">#&gt;  6 hvd.hwiwg8  https:… http… "[[\…  2.02e7 Mans…  &lt;NA&gt;   "{\"id…    1903 "{\"id…</span></span>
<span><span class="co">#&gt;  7 mdp.390150… https:… http… "[[\…  2.02e7 Nort… "[[\"N… "[{\"i…    1877 "{\"id…</span></span>
<span><span class="co">#&gt;  8 uc1.311580… https:… http… "[[\…  2.02e7 Nort…  &lt;NA&gt;   "[{\"i…    1922 "[{\"i…</span></span>
<span><span class="co">#&gt;  9 hvd.320440… https:… http… "[[\…  2.02e7 Nort…  &lt;NA&gt;   "{\"id…    1903 "{\"id…</span></span>
<span><span class="co">#&gt; 10 mdp.390150… https:… http… "[[\…  2.02e7 Pers…  &lt;NA&gt;   "{\"id…    1922 "[{\"i…</span></span>
<span><span class="co">#&gt; 11 mdp.390150… https:… http… "[[\…  2.02e7 Nort…  &lt;NA&gt;   "{\"id…    1892 "{\"id…</span></span>
<span><span class="co">#&gt; 12 uiuo.ark:/… https:… http… "[[\…  2.02e7 Nort…  &lt;NA&gt;   "[{\"i…    1818 "[{\"i…</span></span>
<span><span class="co">#&gt; 13 pst.000025… https:… http… "[[\…  2.02e7 Prid…  &lt;NA&gt;   "{\"id…      NA "{\"id…</span></span>
<span><span class="co">#&gt; 14 mdp.390150… https:… http… "[[\…  2.02e7 Prid…  &lt;NA&gt;   "{\"id…    1913 "[{\"i…</span></span>
<span><span class="co">#&gt; 15 hvd.hn6m7q  https:… http… "[[\…  2.02e7 Prid… "[[\"N… "{\"id…    1906 "{\"id…</span></span>
<span><span class="co">#&gt; 16 uiuo.ark:/… https:… http… "[[\…  2.02e7 Sens…  &lt;NA&gt;   "{\"id…    1811 "{\"id…</span></span>
<span><span class="co">#&gt; 17 hvd.hwhs4m  https:… http… "[[\…  2.02e7 Sens…  &lt;NA&gt;   "{\"id…    1892 "{\"id…</span></span>
<span><span class="co">#&gt; 18 nyp.334330… https:… http… "[[\…  2.02e7 Sens…  &lt;NA&gt;   "{\"id…    1892 "{\"id…</span></span>
<span><span class="co">#&gt; # … with 15 more variables: pubPlace &lt;chr&gt;, language &lt;chr&gt;, accessRights &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   accessProfile &lt;chr&gt;, sourceInstitution &lt;chr&gt;, mainEntityOfPage &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   oclc &lt;chr&gt;, isbn &lt;chr&gt;, genre &lt;chr&gt;, typeOfResource &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   lastRightsUpdateDate &lt;int&gt;, enumerationChronology &lt;chr&gt;, lcc &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   lccn &lt;chr&gt;, category &lt;chr&gt;, and abbreviated variable names ¹​schemaVersion,</span></span>
<span><span class="co">#&gt; #   ²​dateCreated, ³​alternateTitle, ⁴​contributor, ⁵​publisher</span></span>
<span><span class="co">#&gt; # ℹ Use `colnames()` to see all variable names</span></span>
<span></span>
<span><span class="fu"><a href="../reference/read_cached_htids.html">read_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_type <span class="op">=</span> <span class="st">"pagemeta"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 13,322 × 17</span></span>
<span><span class="co">#&gt;    htid       page seq   version token…¹ lineC…² empty…³ sente…⁴ calcu…⁵ secti…⁶</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 pst.0000…     5 0000… 542549…       3       2       0       2 en            3</span></span>
<span><span class="co">#&gt;  2 pst.0000…     8 0000… 116e6b…     128      19       0       5 en          128</span></span>
<span><span class="co">#&gt;  3 pst.0000…     9 0000… 281ad5…       3       2       0      NA so            3</span></span>
<span><span class="co">#&gt;  4 pst.0000…    11 0000… 9e6f16…       1       1       0      NA &lt;NA&gt;          1</span></span>
<span><span class="co">#&gt;  5 pst.0000…    13 0000… 97a337…     236      21       1       7 en          235</span></span>
<span><span class="co">#&gt;  6 pst.0000…    13 0000… 97a337…     236      21       1       7 en            1</span></span>
<span><span class="co">#&gt;  7 pst.0000…    14 0000… eecf06…     490      37       0      19 en            4</span></span>
<span><span class="co">#&gt;  8 pst.0000…    14 0000… eecf06…     490      37       0      19 en          485</span></span>
<span><span class="co">#&gt;  9 pst.0000…    14 0000… eecf06…     490      37       0      19 en            1</span></span>
<span><span class="co">#&gt; 10 pst.0000…    15 0000… 49951b…     494      37       0      14 en          493</span></span>
<span><span class="co">#&gt; # … with 13,312 more rows, 7 more variables: sectionLineCount &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   sectionEmptyLineCount &lt;int&gt;, sectionSentenceCount &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   sectionCapAlphaSeq &lt;int&gt;, sectionBeginCharCount &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   sectionEndCharCount &lt;chr&gt;, section &lt;chr&gt;, and abbreviated variable names</span></span>
<span><span class="co">#&gt; #   ¹​tokenCount, ²​lineCount, ³​emptyLineCount, ⁴​sentenceCount,</span></span>
<span><span class="co">#&gt; #   ⁵​calculatedLanguage, ⁶​sectionTokenCount</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre></div>
<p>For large corpora, we can also cache files to the feather or parquet format, and manipulate them with the {arrow} package:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="co"># cache_htids(austen_sample, cache_format = "parquet") Not needed - we already cached files to the right format</span></span>
<span></span>
<span><span class="va">austen_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_cached_htids.html">read_cached_htids</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_format <span class="op">=</span> <span class="st">"parquet"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">austen_dataset</span> </span>
<span><span class="co">#&gt; FileSystemDataset (query)</span></span>
<span><span class="co">#&gt; htid: string</span></span>
<span><span class="co">#&gt; token: string</span></span>
<span><span class="co">#&gt; POS: string</span></span>
<span><span class="co">#&gt; count: int32</span></span>
<span><span class="co">#&gt; section: string</span></span>
<span><span class="co">#&gt; page: int32</span></span>
<span><span class="co">#&gt; schemaVersion: string</span></span>
<span><span class="co">#&gt; id: string</span></span>
<span><span class="co">#&gt; type: string</span></span>
<span><span class="co">#&gt; dateCreated: int32</span></span>
<span><span class="co">#&gt; title: string</span></span>
<span><span class="co">#&gt; alternateTitle: string</span></span>
<span><span class="co">#&gt; contributor: string</span></span>
<span><span class="co">#&gt; pubDate: int32</span></span>
<span><span class="co">#&gt; publisher: string</span></span>
<span><span class="co">#&gt; pubPlace: string</span></span>
<span><span class="co">#&gt; language: string</span></span>
<span><span class="co">#&gt; accessRights: string</span></span>
<span><span class="co">#&gt; accessProfile: string</span></span>
<span><span class="co">#&gt; sourceInstitution: string</span></span>
<span><span class="co">#&gt; mainEntityOfPage: string</span></span>
<span><span class="co">#&gt; oclc: string</span></span>
<span><span class="co">#&gt; isbn: string</span></span>
<span><span class="co">#&gt; genre: string</span></span>
<span><span class="co">#&gt; typeOfResource: string</span></span>
<span><span class="co">#&gt; lastRightsUpdateDate: int32</span></span>
<span><span class="co">#&gt; seq: string</span></span>
<span><span class="co">#&gt; version: string</span></span>
<span><span class="co">#&gt; tokenCount: int32</span></span>
<span><span class="co">#&gt; lineCount: int32</span></span>
<span><span class="co">#&gt; emptyLineCount: int32</span></span>
<span><span class="co">#&gt; sentenceCount: int32</span></span>
<span><span class="co">#&gt; calculatedLanguage: string</span></span>
<span><span class="co">#&gt; sectionTokenCount: int32</span></span>
<span><span class="co">#&gt; sectionLineCount: int32</span></span>
<span><span class="co">#&gt; sectionEmptyLineCount: int32</span></span>
<span><span class="co">#&gt; sectionSentenceCount: int32</span></span>
<span><span class="co">#&gt; sectionCapAlphaSeq: int32</span></span>
<span><span class="co">#&gt; sectionBeginCharCount: string</span></span>
<span><span class="co">#&gt; sectionEndCharCount: string</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See $.data for the source Arrow object</span></span></code></pre></div>
<p>This enables some very fast aggregations without having to load all the data in memory. For a small corpus like this this does not make a difference (we can put the entire corpus in memory), but in principle one can do operations like this with thousands of files:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">austen_dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">token</span>, wt<span class="op">=</span><span class="va">count</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 28,833 × 2</span></span>
<span><span class="co">#&gt;    token      n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 ,     167916</span></span>
<span><span class="co">#&gt;  2 .      90404</span></span>
<span><span class="co">#&gt;  3 the    73470</span></span>
<span><span class="co">#&gt;  4 to     68624</span></span>
<span><span class="co">#&gt;  5 and    63718</span></span>
<span><span class="co">#&gt;  6 of     63020</span></span>
<span><span class="co">#&gt;  7 a      38757</span></span>
<span><span class="co">#&gt;  8 her    37051</span></span>
<span><span class="co">#&gt;  9 I      36750</span></span>
<span><span class="co">#&gt; 10 was    32556</span></span>
<span><span class="co">#&gt; # … with 28,823 more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Suppose we only want pages where the language is English, there are at least two sentences in the body of the text, and in those pages we only want the nouns that start with a capital letter. This is very fast and uses little memory:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nouns_only_starts_with_cap</span> <span class="op">&lt;-</span> <span class="va">austen_dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">calculatedLanguage</span> <span class="op">==</span> <span class="st">"en"</span>, </span>
<span>         <span class="va">section</span> <span class="op">==</span> <span class="st">"body"</span>,</span>
<span>         <span class="va">sectionSentenceCount</span> <span class="op">&gt;</span> <span class="fl">2</span>,</span>
<span>         <span class="fu">str_detect</span><span class="op">(</span><span class="va">POS</span>, <span class="st">"^NN"</span><span class="op">)</span>,</span>
<span>         <span class="fu">str_detect</span><span class="op">(</span><span class="va">token</span>, <span class="st">"^[A-Z][a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can also clear the cache to get rid of files we don’t want:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clear_cache.html">clear_cache</a></span><span class="op">(</span><span class="va">austen_sample</span>, cache_format <span class="op">=</span> <span class="st">"csv"</span><span class="op">)</span></span></code></pre></div>
<p>We can now use the parquet dataset to create a <a href="https://quanteda.io" class="external-link">quanteda</a> document-feature or term-cooccurrence matrix for further analysis using {tidytext} and other packages.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io" class="external-link">quanteda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext" class="external-link">tidytext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="va">nouns_only_starts_with_cap</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">austen_sample</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>text_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">htid</span>, <span class="va">page</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>,</span>
<span>         token <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">token</span>, <span class="va">Novel</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">cast_dfm</span><span class="op">(</span><span class="va">text_id</span>, <span class="va">token</span>, <span class="va">count</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfm</span></span>
<span><span class="co">#&gt; Document-feature matrix of: 6,964 documents, 4,726 features (99.81% sparse) and 0 docvars.</span></span>
<span><span class="co">#&gt;                        features</span></span>
<span><span class="co">#&gt; docs                    Books_Emma Box_Emma Number_Emma Buccaneer_Emma</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_10          1        1           1              1</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_13          0        0           0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_14          0        0           0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_15          0        0           0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_16          0        0           0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_17          0        0           0              0</span></span>
<span><span class="co">#&gt;                        features</span></span>
<span><span class="co">#&gt; docs                    Standard_Emma International_Emma Inc._Emma</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_10             1                  1         2</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_13             0                  0         0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_14             0                  0         0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_15             0                  0         0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_16             0                  0         0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_17             0                  0         0</span></span>
<span><span class="co">#&gt;                        features</span></span>
<span><span class="co">#&gt; docs                    Copyright_Emma Book_Emma Cutchogue_Emma</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_10              1         1              1</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_13              0         0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_14              0         0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_15              0         0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_16              0         0              0</span></span>
<span><span class="co">#&gt;   mdp.39015041924641_17              0         0              0</span></span>
<span><span class="co">#&gt; [ reached max_ndoc ... 6,958 more documents, reached max_nfeat ... 4,716 more features ]</span></span>
<span></span>
<span></span>
<span><span class="fu">docvars</span><span class="op">(</span><span class="va">dfm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nouns_only_starts_with_cap</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">token</span><span class="op">:</span><span class="op">-</span><span class="va">section</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For example, we might want to see with character names co-occur on the page (a bit of network analysis):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">wordVectors</span><span class="op">)</span> <span class="co"># from remotes::install_github("bmschmidt/wordVectors")</span></span>
<span><span class="va">fcm</span> <span class="op">&lt;-</span> <span class="fu">fcm</span><span class="op">(</span><span class="va">dfm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>             <span class="fu">dfm_trim</span><span class="op">(</span>min_termfreq <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>             <span class="fu">dfm_tfidf</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>             <span class="fu">dfm_compress</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fcm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">as.VectorSpaceModel</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">closest_to</span><span class="op">(</span><span class="st">"Emma_Emma"</span><span class="op">)</span> </span>
<span><span class="co">#&gt;              word similarity to "Emma_Emma"</span></span>
<span><span class="co">#&gt; 1       Emma_Emma                 1.0000000</span></span>
<span><span class="co">#&gt; 2       Miss_Emma                 0.9242459</span></span>
<span><span class="co">#&gt; 3        Mr._Emma                 0.9021827</span></span>
<span><span class="co">#&gt; 4        Box_Emma                 0.7488139</span></span>
<span><span class="co">#&gt; 5     Weston_Emma                 0.7308751</span></span>
<span><span class="co">#&gt; 6  Woodhouse_Emma                 0.7302285</span></span>
<span><span class="co">#&gt; 7    Chapter_Emma                 0.7098783</span></span>
<span><span class="co">#&gt; 8   Highbury_Emma                 0.6878682</span></span>
<span><span class="co">#&gt; 9       Mrs._Emma                 0.6569877</span></span>
<span><span class="co">#&gt; 10    London_Emma                 0.6242129</span></span>
<span><span class="va">fcm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">as.VectorSpaceModel</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">closest_to</span><span class="op">(</span><span class="st">"Frank_Emma"</span><span class="op">)</span></span>
<span><span class="co">#&gt;              word similarity to "Frank_Emma"</span></span>
<span><span class="co">#&gt; 1      Frank_Emma                  1.0000000</span></span>
<span><span class="co">#&gt; 2  Churchill_Emma                  0.8608211</span></span>
<span><span class="co">#&gt; 3      Bates_Emma                  0.7746964</span></span>
<span><span class="co">#&gt; 4      Elton_Emma                  0.7613324</span></span>
<span><span class="co">#&gt; 5     Nobody_Emma                  0.7432131</span></span>
<span><span class="co">#&gt; 6  Knightley_Emma                  0.7213641</span></span>
<span><span class="co">#&gt; 7   Randalls_Emma                  0.7006529</span></span>
<span><span class="co">#&gt; 8  Everybody_Emma                  0.6899662</span></span>
<span><span class="co">#&gt; 9       Mrs._Emma                  0.6574228</span></span>
<span><span class="co">#&gt; 10  Enscombe_Emma                  0.6405108</span></span>
<span><span class="va">fcm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">as.VectorSpaceModel</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">closest_to</span><span class="op">(</span><span class="st">"Fanny_Mansfield Park"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         word similarity to "Fanny_Mansfield Park"</span></span>
<span><span class="co">#&gt; 1       Fanny_Mansfield Park                            1.0000000</span></span>
<span><span class="co">#&gt; 2      Norris_Mansfield Park                            0.7229268</span></span>
<span><span class="co">#&gt; 3      London_Mansfield Park                            0.6847265</span></span>
<span><span class="co">#&gt; 4       Price_Mansfield Park                            0.6730201</span></span>
<span><span class="co">#&gt; 5         Mr._Mansfield Park                            0.6548993</span></span>
<span><span class="co">#&gt; 6  Portsmouth_Mansfield Park                            0.6468854</span></span>
<span><span class="co">#&gt; 7   Mansfield_Mansfield Park                            0.6427882</span></span>
<span><span class="co">#&gt; 8    Bertrams_Mansfield Park                            0.6314474</span></span>
<span><span class="co">#&gt; 9         Tom_Mansfield Park                            0.6201168</span></span>
<span><span class="co">#&gt; 10       Mrs._Mansfield Park                            0.6100312</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu">text2vec</span><span class="fu">::</span><span class="fu">sim2</span><span class="op">(</span><span class="va">fcm</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># requires package text2vec</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu">tidygraph</span><span class="fu">::</span><span class="fu">as_tbl_graph</span><span class="op">(</span><span class="va">distances</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">activate</span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">&gt;</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">activate</span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>connectivity <span class="op">=</span> <span class="fu">centrality_degree</span><span class="op">(</span>weights <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">connectivity</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name_simple <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">name</span>, <span class="st">"_.+"</span><span class="op">)</span>,</span>
<span>         novel <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">name</span>, <span class="st">".+_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">austen_sample</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">Novel</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="op">~</span><span class="va">graph</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">novel</span> <span class="op">==</span> <span class="va">.x</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>         <span class="fu">ggraph</span><span class="op">(</span>layout <span class="op">=</span> <span class="st">"stress"</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu">geom_edge_link</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu">geom_node_label</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">name_simple</span>, color <span class="op">=</span> <span class="va">novel</span><span class="op">)</span>,</span>
<span>                         show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="va">.x</span><span class="op">)</span> </span>
<span>  <span class="op">)</span> </span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="images/example-workflow-unnamed-chunk-21-1.png"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span></code></pre>
<p><img src="images/example-workflow-unnamed-chunk-21-2.png"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span></code></pre>
<p><img src="images/example-workflow-unnamed-chunk-21-3.png"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span></code></pre>
<p><img src="images/example-workflow-unnamed-chunk-21-4.png"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span></code></pre>
<p><img src="images/example-workflow-unnamed-chunk-21-5.png"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span></code></pre>
<p><img src="images/example-workflow-unnamed-chunk-21-6.png"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Xavier Marquez, Ben Schmidt.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
