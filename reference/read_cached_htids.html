<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Read Cached HTIDs — read_cached_htids • hathiTools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Read Cached HTIDs — read_cached_htids"><meta property="og:description" content="Takes a set of Hathi Trust IDs and reads their extracted features and
associated (page- and volume- level) metadata into memory or into an arrow Dataset. A typical workflow with this package should
normally involve selecting an appropriate set of Hathi Trust IDs (via
workset_builder), downloading their Extracted Features files to your local
machine (via rsync_from_hathi), caching these slow-to-load JSON Extracted
Features files to a faster-loading format using cache_htids, and then using
read_cached_htids to read them into a single data frame or arrow Dataset for further work."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hathiTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/example_workflow.html">An Example Workflow</a>
    </li>
    <li>
      <a href="../articles/topic_models_using_hathi_ef.html">Topic Modeling using the Hathi Trust Extracted Features Files</a>
    </li>
    <li>
      <a href="../articles/using_the_hathi_bookworm.html">Using the Hathi Trust Bookworm Tool</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/xmarquez/hathiTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Read Cached HTIDs</h1>
    <small class="dont-index">Source: <a href="https://github.com/xmarquez/hathiTools/blob/HEAD/R/cache_tools.R" class="external-link"><code>R/cache_tools.R</code></a></small>
    <div class="hidden name"><code>read_cached_htids.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Takes a set of Hathi Trust IDs and reads their extracted features and
associated (page- and volume- level) metadata into memory or into an <a href="https://arrow.apache.org/docs/r/reference/Dataset.html" class="external-link">arrow Dataset</a>. A typical workflow with this package should
normally involve selecting an appropriate set of Hathi Trust IDs (via
<a href="workset_builder.html">workset_builder</a>), downloading their Extracted Features files to your local
machine (via <a href="rsync_from_hathi.html">rsync_from_hathi</a>), caching these slow-to-load JSON Extracted
Features files to a faster-loading format using <a href="cache_htids.html">cache_htids</a>, and then using
read_cached_htids to read them into a single data frame or <a href="https://arrow.apache.org/docs/r/reference/Dataset.html" class="external-link">arrow Dataset</a> for further work.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">read_cached_htids</span><span class="op">(</span></span>
<span>  <span class="va">htids</span>,</span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"hathiTools.ef.dir"</span><span class="op">)</span>,</span>
<span>  cache_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ef"</span>, <span class="st">"meta"</span>, <span class="st">"pagemeta"</span><span class="op">)</span>,</span>
<span>  cache_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"hathiTools.cacheformat"</span><span class="op">)</span>,</span>
<span>  nest_char_count <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>htids</dt>
<dd><p>A character vector of Hathi Trust ids, a workset created with
<a href="workset_builder.html">workset_builder</a>, or a data frame with a column named "htid" containing
the Hathi Trust ids that require caching. If the JSON Extracted Features
files for these htids have not been downloaded via <a href="rsync_from_hathi.html">rsync_from_hathi</a> or
<a href="get_hathi_counts.html">get_hathi_counts</a> to <code>dir</code>, nothing will be cached (unless <code>attempt_rsync</code>
is <code>TRUE</code>).</p></dd>


<dt>dir</dt>
<dd><p>The directory where the download extracted features files are to
be found. Defaults to <code>getOption("hathiTools.ef.dir")</code>, which is just
"hathi-ef" on load.</p></dd>


<dt>cache_type</dt>
<dd><p>Type of information cached. The default is c("ef", "meta",
"pagemeta"), which refers to the extracted features, the volume metadata,
and the page metadata. Omitting one of these caches or finds only the rest
(e.g., <code>cache_type = "ef"</code> caches only the EF files, not their associated
metadata or page metadata).</p></dd>


<dt>cache_format</dt>
<dd><p>File format of cache for Extracted Features files.
Defaults to <code>getOption("hathiTools.cacheformat")</code>, which is "csv.gz" on
load. Allowed cache types are: compressed csv (the default), "none" (no
local caching of JSON download; only JSON file kept), "rds", "feather" and
"parquet" (suitable for use with arrow; needs the arrow package
installed), or "text2vec.csv" (a csv suitable for use with the package
<a href="https://cran.r-project.org/package=text2vec" class="external-link">text2vec</a>).</p></dd>


<dt>nest_char_count</dt>
<dd><p>Whether to create a column with a tibble for the
<code>sectionBeginCharCount</code> and <code>sectionEndCharCount</code> columns in the page
metadata. The default is <code>FALSE</code>; if so the counts of characters at the
beginning and end of lines are left as a JSON-formatted string (which can
in turn be transformed into a tibble manually).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a> with the extracted features, plus the
desired (volume-level or page-level) metadata, or an <a href="https://arrow.apache.org/docs/r/reference/Dataset.html" class="external-link">arrow Dataset</a>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">htids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mdp.39015008706338"</span>, <span class="st">"mdp.39015058109706"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Download and cache files first:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="cache_htids.html">cache_htids</a></span><span class="op">(</span><span class="va">htids</span>, dir <span class="op">=</span> <span class="va">dir</span>, cache_type <span class="op">=</span> <span class="st">"ef"</span>, attempt_rsync <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2 HTIDs have already been cached to csv.gz format.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> All existing JSON files already cached to required formats.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   htid               local_loc                            cache…¹ cache…² exists</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> mdp.39015008706338 /tmp/RtmpdUz0R0/mdp/31003/mdp.39015… csv.gz  ef      TRUE  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> mdp.39015058109706 /tmp/RtmpdUz0R0/mdp/31500/mdp.39015… csv.gz  ef      TRUE  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with abbreviated variable names ¹​cache_format, ²​cache_type</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now read them into memory:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">efs</span> <span class="op">&lt;-</span> <span class="fu">read_cached_htids</span><span class="op">(</span><span class="va">htids</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">efs</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 430,772 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    htid               token POS   count section  page</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> mdp.39015008706338 E     UNK       3 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> mdp.39015008706338 s     UNK       1 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> mdp.39015008706338 .     UNK       1 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> mdp.39015008706338 N     UNK       2 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> mdp.39015008706338 IllE  UNK       1 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> mdp.39015008706338 ::    UNK       1 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> mdp.39015008706338 |     UNK       3 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> mdp.39015008706338 -'    UNK       1 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> mdp.39015008706338 -     UNK       6 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> mdp.39015008706338 #     UNK       1 body        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 430,762 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Xavier Marquez, Ben Schmidt.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

