<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Caches downloaded JSON Extracted Features files to another format — cache_htids • hathiTools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Caches downloaded JSON Extracted Features files to another format — cache_htids"><meta property="og:description" content="This function takes a set of Hathi Trust IDs (usually already downloaded via
rsync_from_hathi) and caches the JSON files to another format (e.g., csv or
rds or parquet) along them. A typical workflow with this package normally
involves selecting an appropriate set of Hathi Trust IDs (via
workset_builder), downloading their Extracted Features files to your local
machine (via rsync_from_hathi), caching these slow-to-load JSON Extracted
Features files to a faster-loading format using cache_htids, and then using
read_cached_htids to read them into a single data frame or arrow Dataset for further work."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hathiTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/example_workflow.html">An Example Workflow</a>
    </li>
    <li>
      <a href="../articles/topic_models_using_hathi_ef.html">Topic Modeling using the Hathi Trust Extracted Features Files</a>
    </li>
    <li>
      <a href="../articles/using_the_hathi_bookworm.html">Using the Hathi Trust Bookworm Tool</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/xmarquez/hathiTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Caches downloaded JSON Extracted Features files to another format</h1>
    <small class="dont-index">Source: <a href="https://github.com/xmarquez/hathiTools/blob/HEAD/R/cache_tools.R" class="external-link"><code>R/cache_tools.R</code></a></small>
    <div class="hidden name"><code>cache_htids.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function takes a set of Hathi Trust IDs (usually already downloaded via
<a href="rsync_from_hathi.html">rsync_from_hathi</a>) and caches the JSON files to another format (e.g., csv or
rds or parquet) along them. A typical workflow with this package normally
involves selecting an appropriate set of Hathi Trust IDs (via
<a href="workset_builder.html">workset_builder</a>), downloading their Extracted Features files to your local
machine (via <a href="rsync_from_hathi.html">rsync_from_hathi</a>), caching these slow-to-load JSON Extracted
Features files to a faster-loading format using cache_htids, and then using
<a href="read_cached_htids.html">read_cached_htids</a> to read them into a single data frame or <a href="https://arrow.apache.org/docs/r/reference/Dataset.html" class="external-link">arrow Dataset</a> for further work.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cache_htids</span><span class="op">(</span></span>
<span>  <span class="va">htids</span>,</span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"hathiTools.ef.dir"</span><span class="op">)</span>,</span>
<span>  cache_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ef"</span>, <span class="st">"meta"</span>, <span class="st">"pagemeta"</span><span class="op">)</span>,</span>
<span>  cache_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"hathiTools.cacheformat"</span><span class="op">)</span>,</span>
<span>  keep_json <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  attempt_rsync <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  attempt_parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>htids</dt>
<dd><p>A character vector of Hathi Trust ids, a workset created with
<a href="workset_builder.html">workset_builder</a>, or a data frame with a column named "htid" containing
the Hathi Trust ids that require caching. If the JSON Extracted Features
files for these htids have not been downloaded via <a href="rsync_from_hathi.html">rsync_from_hathi</a> or
<a href="get_hathi_counts.html">get_hathi_counts</a> to <code>dir</code>, nothing will be cached (unless <code>attempt_rsync</code>
is <code>TRUE</code>).</p></dd>


<dt>dir</dt>
<dd><p>The directory where the download extracted features files are to
be found. Defaults to <code>getOption("hathiTools.ef.dir")</code>, which is just
"hathi-ef" on load.</p></dd>


<dt>cache_type</dt>
<dd><p>Type of information cached. The default is c("ef", "meta",
"pagemeta"), which refers to the extracted features, the volume metadata,
and the page metadata. Omitting one of these caches or finds only the rest
(e.g., <code>cache_type = "ef"</code> caches only the EF files, not their associated
metadata or page metadata).</p></dd>


<dt>cache_format</dt>
<dd><p>File format of cache for Extracted Features files.
Defaults to <code>getOption("hathiTools.cacheformat")</code>, which is "csv.gz" on
load. Allowed cache types are: compressed csv (the default), "none" (no
local caching of JSON download; only JSON file kept), "rds", "feather" and
"parquet" (suitable for use with arrow; needs the arrow package
installed), or "text2vec.csv" (a csv suitable for use with the package
<a href="https://cran.r-project.org/package=text2vec" class="external-link">text2vec</a>).</p></dd>


<dt>keep_json</dt>
<dd><p>Whether to keep the downloaded json files. Default is
<code>TRUE</code>; if <code>FALSE</code>, it only keeps the local cached files (e.g., the csv
files) and deletes the associated JSON files.</p></dd>


<dt>attempt_rsync</dt>
<dd><p>If <code>TRUE</code>, and some JSON EF files are not found in
<code>dir</code>, the function will call <a href="rsync_from_hathi.html">rsync_from_hathi</a> to attempt to download
these first.</p></dd>


<dt>attempt_parallel</dt>
<dd><p>Default is <code>FALSE</code>. If <code>TRUE</code>, will attempt to use
the <a href="https://furrr.futureverse.org/reference/furrr-package.html" class="external-link">furrr</a> package to cache files in parallel. You will need
to call <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> beforehand to determine the specific parallel
strategy to be used; <code>plan(multisession)</code> usually works fine.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A tibble with the paths of the cached files and an indicator of
whether each htid was successfully cached.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">htids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mdp.39015008706338"</span>, <span class="st">"mdp.39015058109706"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Caches nothing (nothing has been downloaded to `dir`):</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cache_htids</span><span class="op">(</span><span class="va">htids</span>, dir <span class="op">=</span> <span class="va">dir</span>, cache_type <span class="op">=</span> <span class="st">"ef"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2 HTIDs cannot be cached, since their JSON EF files have not been downloaded or do not exist in the Hathi Trust rsync server.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Try using rsync_from_hathi(htids) to download them.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> All existing JSON files already cached to required formats.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 0 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 5 variables: htid &lt;chr&gt;, local_loc &lt;glue&gt;, cache_format &lt;chr&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   cache_type &lt;chr&gt;, exists &lt;lgl&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Tries to rsync first, then caches</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cache_htids</span><span class="op">(</span><span class="va">htids</span>, dir <span class="op">=</span> <span class="va">dir</span>, cache_type <span class="op">=</span> <span class="st">"ef"</span>, attempt_rsync <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attempting to rsync 2 Hathi Trust IDs before caching</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preparing to cache 2 EF files to /tmp/RtmplkV3td (../..) </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Now caching EF file for mdp.39015008706338</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Now caching EF file for mdp.39015058109706</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   htid               local_loc                            cache…¹ cache…² exists</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> mdp.39015008706338 /tmp/RtmplkV3td/mdp/31003/mdp.39015… csv.gz  ef      TRUE  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> mdp.39015058109706 /tmp/RtmplkV3td/mdp/31500/mdp.39015… csv.gz  ef      TRUE  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with abbreviated variable names ¹​cache_format, ²​cache_type</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Xavier Marquez, Ben Schmidt.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

